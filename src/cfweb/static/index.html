<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>TerraDrone Web Interface</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" onerror="console.warn('Chart.js failed to load from CDN')"></script>
</head>
<body>
    <!-- Vertical Navigation Bar -->
    <nav class="vertical-nav">
        <div class="nav-brand">TD</div>
        <div class="nav-items">
            <button class="nav-tab active" data-tab="flight" title="Flight Control">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                    <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                </svg>
                <span>Flight</span>
            </button>
            <button class="nav-tab" data-tab="logblocks" title="Log Blocks">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                </svg>
                <span>Logs</span>
            </button>
            <button class="nav-tab" data-tab="params" title="Parameters">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m0 5.66l4.24 4.24M23 12h-6m-6 0H1m18.66 5.66l-4.24-4.24m-5.66 0l-4.24 4.24"></path>
                </svg>
                <span>Params</span>
            </button>
            <button class="nav-tab" data-tab="plotter" title="Plotter">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
                <span>Plotter</span>
            </button>
            <button class="nav-tab" data-tab="loco" title="Loco Positioning">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <span>Loco</span>
            </button>
            <button class="nav-tab" data-tab="lighthouse" title="Lighthouse">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <circle cx="12" cy="12" r="6"></circle>
                    <circle cx="12" cy="12" r="2"></circle>
                </svg>
                <span>Light</span>
            </button>
            <button class="nav-tab" data-tab="console" title="Console">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="4 17 10 11 4 5"></polyline>
                    <line x1="12" y1="19" x2="20" y2="19"></line>
                </svg>
                <span>Console</span>
            </button>
            <button class="nav-tab" data-tab="led" title="LED">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                <span>LED</span>
            </button>
            <button class="nav-tab" data-tab="tuning" title="Tuning">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="4" y1="21" x2="4" y2="14"></line>
                    <line x1="4" y1="10" x2="4" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12" y2="3"></line>
                    <line x1="20" y1="21" x2="20" y2="16"></line>
                    <line x1="20" y1="12" x2="20" y2="3"></line>
                </svg>
                <span>Tuning</span>
            </button>
            <button class="nav-tab" data-tab="shop" title="Shop">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <span>Shop</span>
            </button>
        </div>
        <div class="nav-bottom">
            <button class="nav-icon" title="Settings" onclick="toggleSettingsMenu()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m0 5.66l4.24 4.24M23 12h-6m-6 0H1m18.66 5.66l-4.24-4.24m-5.66 0l-4.24 4.24"></path>
                </svg>
            </button>
            <button class="nav-icon" title="Power" onclick="handleExit()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                    <line x1="12" y1="2" x2="12" y2="12"></line>
                </svg>
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- Modern Top Navigation Bar -->
        <header class="modern-header">
            <div class="header-left">
                <div class="brand">
                    <h1>TerraDrone</h1>
                </div>
            </div>
            
            <nav class="header-system-menu">
                <button class="nav-pill" onclick="showConnectionDialog()" data-i18n="connect">Connect</button>
                <button class="nav-pill" onclick="showInputConfigDialog()" data-i18n="inputDevice">Input Device</button>
                <button class="nav-pill" onclick="showLogConfigDialog()" data-i18n="settings">Settings</button>
                <button class="nav-pill" onclick="toggleViewMenu()" data-i18n="view">View</button>
                <button class="nav-pill" onclick="switchToShop()" data-i18n="shop">Shop</button>
                <select class="nav-pill language-selector" id="languageSelector" onchange="changeLanguage(this.value)" style="padding: 6px 12px; border: 1px solid var(--border-color); border-radius: 20px; background: var(--panel-bg); color: var(--text-color); cursor: pointer;">
                    <option value="en">EN</option>
                    <option value="vi">VI</option>
                </select>
                <button class="nav-pill" id="themeToggleBtn" onclick="toggleTheme()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path id="themeIcon" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </nav>
            
            <div class="header-right">
                <div class="status-indicator" id="statusIndicator">
                    <span class="status-dot"></span>
                    <span id="statusText" data-i18n="disconnected">Disconnected</span>
                </div>
                <div class="battery-indicator" id="batteryIndicator" style="display: none;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="1" y="6" width="18" height="12" rx="2" ry="2"></rect>
                        <line x1="23" y1="13" x2="23" y2="11"></line>
                    </svg>
                    <span id="batteryValue">--</span>%
                </div>
                <div class="separator"></div>
                <button class="header-icon" onclick="toggleSearch()" title="Search">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                </button>
                <button class="header-icon" onclick="toggleNotifications()" title="Notifications">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                </button>
                <div class="header-menu dropdown">
                    <button class="profile-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </button>
                    <div class="dropdown-content profile-menu">
                        <div class="dropdown-item" onclick="showAboutDialog()">
                            <span>About</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" onclick="showBootloaderDialog()">
                            <span>Bootloader</span>
                        </div>
                        <div class="dropdown-item" onclick="showCf2ConfigDialog()">
                            <span>Configure 2.X</span>
                        </div>
                        <div class="dropdown-item" onclick="openConfigFolder()">
                            <span>Config Folder</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" onclick="handleExit()">
                            <span>Exit</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Quick Connection Bar -->
        <section class="quick-connect">
            <button id="quickConnectBtn" class="btn btn-success">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                </svg>
                Quick Connect
            </button>
            <button id="quickDisconnectBtn" class="btn btn-danger" disabled style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
                Disconnect
            </button>
            <span class="quick-connect-info" id="quickConnectInfo">Click to configure connection</span>
        </section>

        <!-- Main Content Area -->
        <div class="main-content">

            <!-- Flight Control Tab -->
            <div id="flight-tab" class="tab-content active">
                <div class="flight-control-container">
                    <!-- Left Column: Basic and Advanced Flight Control -->
                    <div class="flight-control-left">
                        <!-- Basic Flight Control -->
                        <div class="control-panel">
                            <h3>Basic Flight Control</h3>
                            <div class="form-group">
                                <label>Flight Mode:</label>
                                <select id="flightMode" class="select">
                                    <option value="Normal">Normal</option>
                                    <option value="Advanced">Advanced</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Assist Mode:</label>
                                <select id="assistMode" class="select">
                                    <option value="none">None</option>
                                    <option value="althold">Altitude hold</option>
                                    <option value="poshold">Position hold</option>
                                    <option value="heighthold">Height hold</option>
                                    <option value="hover">Hover</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Roll Trim:</label>
                                <input type="number" id="rollTrim" class="input-small" value="0.00" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Pitch Trim:</label>
                                <input type="number" id="pitchTrim" class="input-small" value="0.00" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Control Mode:</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="controlMode" value="attitude" checked> Attitude control</label>
                                    <label><input type="radio" name="controlMode" value="rate"> Rate control</label>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Flight Control -->
                        <div class="panel">
                            <h3>Advanced Flight Control</h3>
                            <div class="form-group">
                                <label>Max angle/rate:</label>
                                <input type="number" id="maxAngle" class="input-small" value="30" min="0" max="90">
                            </div>
                            <div class="form-group">
                                <label>Max Yaw angle/rate:</label>
                                <input type="number" id="maxYawRate" class="input-small" value="200" min="0" max="360">
                            </div>
                            <div class="form-group">
                                <label>Max thrust (%):</label>
                                <input type="number" id="maxThrust" class="input-small" value="80.00" min="0" max="100" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Min thrust (%):</label>
                                <input type="number" id="minThrust" class="input-small" value="25.00" min="0" max="100" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>SlewLimit (%):</label>
                                <input type="number" id="slewLimit" class="input-small" value="45.00" min="0" max="100" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Thrust lowering slewrate (%/sec):</label>
                                <input type="number" id="thrustLoweringSlewRate" class="input-small" value="30.00" min="0" step="0.01">
                            </div>
                        </div>

                        <!-- Expansion boards -->
                        <div class="panel">
                            <h3>Expansion boards</h3>
                            <div class="form-group">
                                <label>LED-ring effect:</label>
                                <select id="ledRingEffect" class="select">
                                    <option value="0">Off</option>
                                    <option value="1">Solid</option>
                                    <option value="2">Blink</option>
                                    <option value="3">Fade</option>
                                    <option value="4">Spinner</option>
                                    <option value="5">Double spinner</option>
                                    <option value="6" selected>Double spinner</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" id="ledRingHeadlight"> LED-ring headlight</label>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Flight Data & Control -->
                    <div class="panel flight-data-panel">
                        <h3>Flight Data</h3>
                        <!-- Attitude Indicator -->
                        <div class="attitude-indicator-container">
                            <canvas id="attitudeIndicator" width="500" height="420"></canvas>
                        </div>
                        <!-- Gamepad Input, State Estimate, and Thrust in parallel columns -->
                        <div class="data-sections-container">
                            <!-- Gamepad Input -->
                            <div class="gamepad-input-section">
                                <h4 data-i18n="gamepadInput">Gamepad Input</h4>
                                <div class="flight-data-values">
                                    <div class="data-row">
                                        <span class="data-label">Thrust:</span>
                                        <input type="text" id="targetThrust" class="data-input" readonly value="">
                                    </div>
                                    <div class="data-row">
                                        <span class="data-label">Pitch:</span>
                                        <input type="text" id="targetPitch" class="data-input" readonly value="">
                                    </div>
                                    <div class="data-row">
                                        <span class="data-label">Roll:</span>
                                        <input type="text" id="targetRoll" class="data-input" readonly value="">
                                    </div>
                                    <div class="data-row">
                                        <span class="data-label">Yaw:</span>
                                        <input type="text" id="targetYaw" class="data-input" readonly value="">
                                    </div>
                                    <div class="data-row">
                                        <span class="data-label">Height:</span>
                                        <input type="text" id="targetHeight" class="data-input" readonly value="">
                                    </div>
                                </div>
                            </div>
                            <!-- State Estimate -->
                            <div class="state-estimate-section">
                                <h4 data-i18n="stateEstimate">State Estimate</h4>
                                <div class="flight-data-values">
                                    <div class="data-row">
                                        <span class="data-label">Thrust:</span>
                                        <input type="text" id="actualThrust" class="data-input" readonly value="0.00%">
                                    </div>
                                    <div class="data-row">
                                        <span class="data-label">X:</span>
                                        <input type="text" id="actualX" class="data-input" readonly value="0.00">
                                    </div>
                                    <div class="data-row">
                                        <span class="data-label">Y:</span>
                                        <input type="text" id="actualY" class="data-input" readonly value="0.00">
                                    </div>
                                    <div class="data-row">
                                        <span class="data-label">Z:</span>
                                        <input type="text" id="actualZ" class="data-input" readonly value="0.00">
                                    </div>
                                    <div class="data-row">
                                        <span class="data-label">Pitch:</span>
                                        <input type="text" id="actualPitch" class="data-input" readonly value="0.00">
                                    </div>
                                    <div class="data-row">
                                        <span class="data-label">Roll:</span>
                                        <input type="text" id="actualRoll" class="data-input" readonly value="0.00">
                                    </div>
                                    <div class="data-row">
                                        <span class="data-label">Yaw:</span>
                                        <input type="text" id="actualYaw" class="data-input" readonly value="0.00">
                                    </div>
                                </div>
                            </div>
                            <!-- Motor Thrust Indicators -->
                            <div class="motor-thrust-section">
                                <div class="motor-thrust-header">
                                    <div class="motor-header-label">Thrust</div>
                                    <div class="motor-header-label">M1</div>
                                    <div class="motor-header-label">M2</div>
                                    <div class="motor-header-label">M3</div>
                                    <div class="motor-header-label">M4</div>
                                </div>
                                <div class="motor-thrust-container">
                                    <div class="motor-group">
                                        <div class="motor-bar-container">
                                            <div class="motor-bar" id="thrustBar" style="height: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="motor-group">
                                        <div class="motor-bar-container">
                                            <div class="motor-bar" id="motor1Bar" style="height: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="motor-group">
                                        <div class="motor-bar-container">
                                            <div class="motor-bar" id="motor2Bar" style="height: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="motor-group">
                                        <div class="motor-bar-container">
                                            <div class="motor-bar" id="motor3Bar" style="height: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="motor-group">
                                        <div class="motor-bar-container">
                                            <div class="motor-bar" id="motor4Bar" style="height: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Command Based Flight Control -->
                            <div class="command-flight-control">
                                <h4>Command Based Flight Control</h4>
                                <div class="command-controls">
                                    <div class="command-buttons-row">
                                        <button id="takeOffBtn" class="btn btn-success" data-i18n="takeOff">Take off</button>
                                        <button id="landBtn" class="btn btn-danger" data-i18n="land">Land</button>
                                    </div>
                                    <div class="directional-controls">
                                        <div class="arrow-grid">
                                            <div></div>
                                            <button class="btn arrow-btn" id="forwardBtn" data-direction="forward" title-i18n="forward" title="Forward">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                                    <polyline points="18 15 12 9 6 15"></polyline>
                                                </svg>
                                            </button>
                                            <div></div>
                                            <button class="btn arrow-btn" id="leftBtn" data-direction="left" title-i18n="left" title="Left">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                                    <polyline points="15 18 9 12 15 6"></polyline>
                                                </svg>
                                            </button>
                                            <div></div>
                                            <button class="btn arrow-btn" id="rightBtn" data-direction="right" title-i18n="right" title="Right">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                                    <polyline points="9 18 15 12 9 6"></polyline>
                                                </svg>
                                            </button>
                                            <div></div>
                                            <button class="btn arrow-btn" id="backBtn" data-direction="back" title-i18n="back" title="Back">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                                    <polyline points="6 9 12 15 18 9"></polyline>
                                                </svg>
                                            </button>
                                            <div></div>
                                        </div>
                                        <div class="vertical-controls">
                                            <button class="btn btn-secondary" id="upBtn" title-i18n="up" data-i18n="up" title="Up">Up</button>
                                            <button class="btn btn-secondary" id="downBtn" title-i18n="down" data-i18n="down" title="Down">Down</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Console Tab -->
            <div id="console-tab" class="tab-content">
                <div class="panel">
                    <div class="console-controls">
                        <button id="clearConsoleBtn" class="btn btn-primary">Clear</button>
                        <button id="dumpSystemLoadBtn" class="btn btn-secondary">Dump System Load</button>
                        <button id="dumpAssertBtn" class="btn btn-secondary">Dump Assert Info</button>
                        <button id="propellerTestBtn" class="btn btn-secondary">Propeller Test</button>
                        <button id="batteryTestBtn" class="btn btn-secondary">Battery Test</button>
                        <button id="storageStatsBtn" class="btn btn-secondary">Storage Stats</button>
                    </div>
                    <div id="consoleOutput" class="console-output"></div>
                </div>
            </div>

            <!-- LED Tab -->
            <div id="led-tab" class="tab-content">
                <div class="panel">
                    <h3>LED Ring Control</h3>
                    <div class="led-ring-container">
                        <div class="led-ring">
                            <div class="led" data-led="0" id="led0"></div>
                            <div class="led" data-led="1" id="led1"></div>
                            <div class="led" data-led="2" id="led2"></div>
                            <div class="led" data-led="3" id="led3"></div>
                            <div class="led" data-led="4" id="led4"></div>
                            <div class="led" data-led="5" id="led5"></div>
                            <div class="led" data-led="6" id="led6"></div>
                            <div class="led" data-led="7" id="led7"></div>
                            <div class="led" data-led="8" id="led8"></div>
                            <div class="led" data-led="9" id="led9"></div>
                            <div class="led" data-led="10" id="led10"></div>
                            <div class="led" data-led="11" id="led11"></div>
                        </div>
                        <div class="led-controls">
                            <div class="form-group">
                                <label>Intensity:</label>
                                <input type="range" id="ledIntensity" min="0" max="100" value="100" class="slider">
                                <span id="ledIntensityValue">100%</span>
                            </div>
                            <div class="form-group">
                                <label>Color:</label>
                                <input type="color" id="ledColor" value="#ff0000">
                            </div>
                            <button id="setAllLedsBtn" class="btn btn-primary">Set All LEDs</button>
                            <button id="clearAllLedsBtn" class="btn btn-secondary">Clear All LEDs</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Log Blocks Tab -->
            <div id="logblocks-tab" class="tab-content">
                <div class="panel">
                    <h3>Log Blocks</h3>
                    <div class="log-blocks-controls">
                        <button id="createLogBlockBtn" class="btn btn-primary">Create Log Block</button>
                        <input type="text" id="logBlockSearch" placeholder="Search log blocks..." class="input">
                    </div>
                    <div id="logBlocksList" class="log-blocks-list">
                        <p class="info-text">Connect to load log blocks</p>
                    </div>
                </div>
            </div>

            <!-- Plotter Tab -->
            <div id="plotter-tab" class="tab-content">
                <div class="panel">
                    <h3>Data Plotter</h3>
                    <div class="plotter-controls">
                        <select id="plotterLogConfig" class="select">
                            <option value="">Select log configuration...</option>
                        </select>
                        <button id="startPlotBtn" class="btn btn-success" disabled>Start Plotting</button>
                        <button id="stopPlotBtn" class="btn btn-danger" disabled>Stop Plotting</button>
                        <button id="clearPlotBtn" class="btn btn-secondary">Clear Plot</button>
                    </div>
                    <div class="plotter-container">
                        <canvas id="plotterCanvas"></canvas>
                    </div>
                </div>
            </div>

            <!-- Parameters Tab -->
            <div id="params-tab" class="tab-content">
                <div class="panel">
                    <h3>Parameters</h3>
                    <div class="params-controls">
                        <input type="text" id="paramSearch" placeholder="Search parameters..." class="input">
                    </div>
                    <div id="paramsList" class="params-list">
                        <p class="info-text">Connect to load parameters</p>
                    </div>
                </div>
            </div>

            <!-- Log TOC Tab -->
            <div id="logtoc-tab" class="tab-content">
                <div class="panel">
                    <h3>Log TOC</h3>
                    <div class="logtoc-controls">
                        <input type="text" id="logtocSearch" placeholder="Search log variables..." class="input">
                    </div>
                    <div id="logtocTree" class="logtoc-tree">
                        <p class="info-text">Connect to load log TOC</p>
                    </div>
                </div>
            </div>

            <!-- Loco Positioning Tab -->
            <div id="loco-tab" class="tab-content">
                <div class="panel">
                    <h3>Loco Positioning</h3>
                    <div class="loco-controls">
                        <button id="locoStartBtn" class="btn btn-success" disabled>Start</button>
                        <button id="locoStopBtn" class="btn btn-danger" disabled>Stop</button>
                        <button id="locoResetBtn" class="btn btn-secondary" disabled>Reset</button>
                    </div>
                    <div class="loco-content">
                        <div class="loco-anchors-section">
                            <h4>Anchors</h4>
                            <div id="locoAnchors" class="loco-anchors-list">
                                <p class="info-text">Connect to view anchors</p>
                            </div>
                        </div>
                        <div class="loco-3d-view">
                            <canvas id="loco3dCanvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lighthouse Tab -->
            <div id="lighthouse-tab" class="tab-content">
                <div class="panel">
                    <h3>Lighthouse Positioning</h3>
                    <div class="lighthouse-controls">
                        <button id="lighthouseLoadConfigBtn" class="btn btn-primary" disabled>Load System Config</button>
                        <button id="lighthouseSaveConfigBtn" class="btn btn-primary" disabled>Save System Config</button>
                        <button id="lighthouseManageGeometryBtn" class="btn btn-secondary" disabled>Manage Base Station Geometry</button>
                        <button id="lighthouseChangeSystemTypeBtn" class="btn btn-secondary" disabled>Change System Type</button>
                        <button id="lighthouseManageModeBtn" class="btn btn-secondary" disabled>Manage Base Station Mode</button>
                    </div>
                    <div class="lighthouse-content">
                        <div class="lighthouse-status-section">
                            <h4>Base Station Status</h4>
                            <div id="lighthouseStatus" class="lighthouse-status-list">
                                <p class="info-text">Connect to view base station status</p>
                            </div>
                        </div>
                        <div class="lighthouse-3d-view">
                            <canvas id="lighthouse3dCanvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tuning Tab -->
            <div id="tuning-tab" class="tab-content">
                <div class="panel">
                    <h3>PID Tuning</h3>
                    <div id="tuningContent" class="tuning-content">
                        <p class="info-text">PID tuning interface will be available when connected</p>
                    </div>
                </div>
            </div>

            <!-- Shop Tab -->
            <div id="shop-tab" class="tab-content">
                <div class="shop-container">
                    <!-- Breadcrumbs -->
                    <div class="breadcrumbs">
                        <a href="#" onclick="showShopHome()" data-i18n="home">Home</a>
                        <span class="breadcrumb-separator">›</span>
                        <a href="#" onclick="showShopHome()" data-i18n="electronics">Electronics</a>
                        <span class="breadcrumb-separator">›</span>
                        <a href="#" onclick="showShopHome()" data-i18n="drones">Drones & Quadcopters</a>
                        <span class="breadcrumb-separator">›</span>
                        <span>TerraDrone</span>
                    </div>

                    <!-- Product Detail View -->
                    <div id="product-detail-view" class="product-detail-container">
                        <div class="product-detail-layout">
                            <!-- Left: Image Gallery -->
                            <div class="product-image-gallery">
                                <div class="main-product-image">
                                    <div class="product-image-placeholder">
                                        <svg width="400" height="400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                            <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="image-thumbnails">
                                    <div class="thumbnail active">
                                        <div class="thumbnail-placeholder">
                                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="thumbnail">
                                        <div class="thumbnail-placeholder">
                                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="thumbnail">
                                        <div class="thumbnail-placeholder">
                                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="thumbnail">
                                        <div class="thumbnail-placeholder">
                                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Center: Product Information -->
                            <div class="product-info-section">
                                <div class="product-brand">
                                    <a href="#" data-i18n="visitStore">Visit the TerraDrone Store</a>
                                </div>
                                <h1 class="product-title" data-i18n="productTitle">TerraDrone 2.1 Nano Quadcopter | Open Source | Research Grade | 7 min Flight Time</h1>
                                
                                <div class="product-rating">
                                    <div class="stars">
                                        <span class="star filled">★</span>
                                        <span class="star filled">★</span>
                                        <span class="star filled">★</span>
                                        <span class="star filled">★</span>
                                        <span class="star half">★</span>
                                    </div>
                                    <a href="#" class="rating-link">4.5</a>
                                    <a href="#" class="rating-link">(249 <span data-i18n="ratings">ratings</span>)</a>
                                    <span class="rating-separator">|</span>
                                    <a href="#" class="rating-link">164 <span data-i18n="answeredQuestions">answered questions</span></a>
                                </div>

                                <div class="product-price-section">
                                    <div class="price-row">
                                        <span class="price-label" data-i18n="mrp">M.R.P.:</span>
                                        <span class="price-mrp" data-price="60.00">$60.00</span>
                                    </div>
                                    <div class="price-row">
                                        <span class="price-main" data-price="48.00">$48.00</span>
                                    </div>
                                    <div class="price-row">
                                        <span class="price-save"><span data-i18n="youSave">You Save:</span> <span data-price="12.00">$12.00</span> (20%)</span>
                                    </div>
                                    <div class="price-tax" data-i18n="inclusiveTaxes">Inclusive of all taxes</div>
                                </div>

                                <div class="product-specs">
                                    <h3 data-i18n="productInfo">Product Information</h3>
                                    <div class="product-info-grid">
                                        <div class="info-row">
                                            <span class="info-label" data-i18n="name">Name:</span>
                                            <span class="info-value">TerraDrone</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label" data-i18n="origin">Origin:</span>
                                            <span class="info-value">TerraTech</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label" data-i18n="material">Material:</span>
                                            <span class="info-value">Aircraft Plywood</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label" data-i18n="features">Features:</span>
                                            <span class="info-value" data-i18n="featuresValue">Wi-Fi control via mobile app, TerraAI learning assistant chatbot, programmable via Arduino IDE, multiple flight modes (Stabilize, Altitude Hold, Position Hold)</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label" data-i18n="recommendedAge">Recommended Age:</span>
                                            <span class="info-value" data-i18n="recommendedAgeValue">Suitable for children aged 12-18 years</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="product-specs">
                                    <h3 data-i18n="technicalSpecs">Technical Specifications</h3>
                                    <ul class="spec-list">
                                        <li><strong data-i18n="sizeWeight">Size & Weight:</strong> <span data-i18n="sizeWeightValue">40x60 cm, weighs 250 grams</span></li>
                                        <li><strong data-i18n="microcontroller">Microcontroller:</strong> <span data-i18n="microcontrollerValue">ESP32-S3 (32-bit RISC-V dual-core, up to 240MHz, Wi-Fi & Bluetooth 5.0)</span></li>
                                        <li><strong data-i18n="sensors">Sensors:</strong> <span data-i18n="sensorsValue">MPU6050 6-axis IMU (3-axis accelerometer + 3-axis gyroscope) for precise motion control</span></li>
                                        <li><strong data-i18n="motors">Motors:</strong> <span data-i18n="motorsValue">4 coreless motors, ~17g thrust each, 2.7:1 thrust-to-weight ratio for stable flight</span></li>
                                        <li><strong data-i18n="batteryFlightTime">Battery & Flight Time:</strong> <span data-i18n="batteryFlightTimeValue">2000 mAh Li-Po battery, maximum flight time 15 minutes, full charge time 60 minutes</span></li>
                                        <li><strong data-i18n="controlRange">Control Range:</strong> <span data-i18n="controlRangeValue">Up to 100 meters via Wi-Fi connection (mobile app or gamepad)</span></li>
                                        <li><strong data-i18n="communication">Communication:</strong> <span data-i18n="communicationValue">Wi-Fi 802.11 b/g/n, Bluetooth 5.0 for app control and TerraAI integration</span></li>
                                        <li><strong data-i18n="flightModes">Flight Modes:</strong> <span data-i18n="flightModesValue">Stabilize, Altitude Hold, Position Hold for different skill levels</span></li>
                                        <li><strong data-i18n="frame">Frame & PCB:</strong> <span data-i18n="frameValue">Aircraft Plywood frame (4g), 4-layer integrated PCB with motor drivers and LED indicators</span></li>
                                        <li><strong data-i18n="expandability">Expandability:</strong> <span data-i18n="expandabilityValue">GPIO pinouts for adding sensors, servos, and expansion modules</span></li>
                                    </ul>
                                </div>

                                <div class="product-specs">
                                    <h3 data-i18n="inTheBox">What's in the Box</h3>
                                    <ul class="spec-list">
                                        <li data-i18n="boxItem1">TerraDrone body with integrated ESP32-S3 flight controller</li>
                                        <li data-i18n="boxItem2">4 propellers (2 spare pairs) - optimized for coreless motors</li>
                                        <li data-i18n="boxItem3">2000 mAh Li-Po battery with protection circuit</li>
                                        <li data-i18n="boxItem4">USB-C charging cable and programming interface</li>
                                        <li data-i18n="boxItem5">Detailed user manual with programming guide</li>
                                        <li data-i18n="boxItem6">Replacement accessories set (propellers, screws, tools)</li>
                                        <li data-i18n="boxItem7">Warranty card and quick start guide</li>
                                        <li data-i18n="boxItem8">TerraAI mobile app access code</li>
                                    </ul>
                                </div>

                                <div class="product-specs">
                                    <h3 data-i18n="warrantyPolicy">Warranty & Policy</h3>
                                    <ul class="spec-list">
                                        <li><strong data-i18n="warrantyPeriod">Warranty Period:</strong> <span data-i18n="warrantyPeriodValue">6 months hardware, 12 months software</span></li>
                                        <li><strong data-i18n="returnPolicy">Return Policy:</strong> <span data-i18n="returnPolicyValue">Free returns within 30 days from purchase date (product must be intact, unused)</span></li>
                                        <li><strong data-i18n="techSupport">Technical Support:</strong> <span data-i18n="techSupportValue">24/7 support via TerraAI chatbot and email</span></li>
                                    </ul>
                                </div>

                                <div class="product-features-grid">
                                    <div class="feature-box">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span data-i18n="dayReturns">30-Day Returns</span>
                                    </div>
                                    <div class="feature-box">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span data-i18n="yearWarranty">1 Year Warranty</span>
                                    </div>
                                    <div class="feature-box">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span data-i18n="openSource">Open Source</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Right: Purchase Box -->
                            <div class="purchase-box">
                                <div class="price-box">
                                    <span class="price-display" data-price="48.00">$48.00</span>
                                    <div class="price-tax-small" data-i18n="inclusiveTaxes">Inclusive of all taxes</div>
                                </div>

                                <div class="delivery-info">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    <div>
                                        <div class="delivery-text" data-i18n="selectDelivery">Select delivery location</div>
                                        <div class="delivery-link"><a href="#" data-i18n="updateLocation">Update location</a></div>
                                    </div>
                                </div>

                                <div class="stock-status">
                                    <span class="in-stock">✓ <span data-i18n="inStock">In Stock</span></span>
                                </div>

                                <div class="quantity-selector">
                                    <label data-i18n="quantity">Quantity:</label>
                                    <select id="productQuantity" class="quantity-select">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5+</option>
                                    </select>
                                </div>

                                <div class="purchase-buttons">
                                    <button class="btn btn-add-cart" data-i18n="addToCart">Add to Cart</button>
                                    <button class="btn btn-buy-now" data-i18n="buyNow">Buy Now</button>
                                </div>

                                <div class="secure-transaction">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                    </svg>
                                    <span data-i18n="secureTransaction">Secure transaction</span>
                                </div>

                                <div class="wishlist-section">
                                    <button class="btn-wishlist" data-i18n="addToWishList">Add to Wish List</button>
                                </div>

                                <div class="other-sellers">
                                    <div class="sellers-link">
                                        <span><span data-i18n="newFrom">New (2) from</span> <span data-price="48.00">$48.00</span></span>
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="9 18 15 12 9 6"></polyline>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Related Products Section -->
                        <div class="related-products-section">
                            <h2 data-i18n="customersAlsoViewed">Customers who viewed this item also viewed</h2>
                            <div class="related-products-grid">
                                <div class="related-product-card">
                                    <div class="related-product-image">
                                        <div class="related-image-placeholder">
                                            <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="related-product-info">
                                        <div class="related-product-title" data-i18n="relatedProduct1">TerraDrone Bolt | Brushless Motors | 12 min Flight</div>
                                        <div class="related-product-rating">
                                            <span class="stars-small">★★★★★</span>
                                            <span class="rating-count">(2,998)</span>
                                        </div>
                                        <div class="related-product-price" data-price="299.00">$299.00</div>
                                    </div>
                                </div>
                                <div class="related-product-card">
                                    <div class="related-product-image">
                                        <div class="related-image-placeholder">
                                            <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="related-product-info">
                                        <div class="related-product-title" data-i18n="relatedProduct2">Expansion Decks Bundle | Flow + Lighthouse + Loco</div>
                                        <div class="related-product-rating">
                                            <span class="stars-small">★★★★☆</span>
                                            <span class="rating-count">(164)</span>
                                        </div>
                                        <div class="related-product-price" data-price="149.00">$149.00</div>
                                    </div>
                                </div>
                                <div class="related-product-card">
                                    <div class="related-product-image">
                                        <div class="related-image-placeholder">
                                            <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="related-product-info">
                                        <div class="related-product-title" data-i18n="relatedProduct3">Complete Starter Kit | Everything You Need</div>
                                        <div class="related-product-rating">
                                            <span class="stars-small">★★★☆☆</span>
                                            <span class="rating-count">(6)</span>
                                        </div>
                                        <div class="related-product-price" data-price="329.00">$329.00</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shop Home View (Product Grid) -->
                    <div id="shop-home-view" class="shop-home-container" style="display: none;">
                        <div class="shop-header">
                            <h2>TerraDrone Store</h2>
                            <p class="shop-subtitle">Professional-grade nano quadcopters for research and development</p>
                        </div>

                        <div class="products-grid">
                        <!-- Product 1: TerraDrone 2.1 -->
                        <div class="product-card">
                            <div class="product-image">
                                <div class="product-placeholder">
                                    <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                        <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="product-info">
                                <h3>TerraDrone 2.1</h3>
                                <p class="product-description">The latest generation of the TerraDrone platform with improved flight performance and extended range.</p>
                                <div class="product-features">
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>STM32F4 MCU</span>
                                    </div>
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>27g weight</span>
                                    </div>
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>7 min flight time</span>
                                    </div>
                                </div>
                                <div class="product-price">
                                    <span class="price">$48</span>
                                    <span class="price-label">USD</span>
                                </div>
                                <button class="btn btn-primary btn-buy">Add to Cart</button>
                            </div>
                        </div>

                        <!-- Product 2: TerraDrone Bolt -->
                        <div class="product-card">
                            <div class="product-image">
                                <div class="product-placeholder">
                                    <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                        <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="product-info">
                                <h3>TerraDrone Bolt</h3>
                                <p class="product-description">High-performance variant with brushless motors for advanced applications and longer flight times.</p>
                                <div class="product-features">
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>Brushless motors</span>
                                    </div>
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>45g weight</span>
                                    </div>
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>12 min flight time</span>
                                    </div>
                                </div>
                                <div class="product-price">
                                    <span class="price">$299</span>
                                    <span class="price-label">USD</span>
                                </div>
                                <button class="btn btn-primary btn-buy">Add to Cart</button>
                            </div>
                        </div>

                        <!-- Product 3: Expansion Decks Bundle -->
                        <div class="product-card">
                            <div class="product-image">
                                <div class="product-placeholder">
                                    <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="9" y1="3" x2="9" y2="21"></line>
                                        <line x1="15" y1="3" x2="15" y2="21"></line>
                                    </svg>
                                </div>
                            </div>
                            <div class="product-info">
                                <h3>Expansion Decks Bundle</h3>
                                <p class="product-description">Complete set of expansion decks including Flow deck, Lighthouse deck, and Loco deck for positioning.</p>
                                <div class="product-features">
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>Flow deck v2</span>
                                    </div>
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>Lighthouse deck</span>
                                    </div>
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>Loco deck</span>
                                    </div>
                                </div>
                                <div class="product-price">
                                    <span class="price">$149</span>
                                    <span class="price-label">USD</span>
                                </div>
                                <button class="btn btn-primary btn-buy">Add to Cart</button>
                            </div>
                        </div>

                        <!-- Product 4: Complete Starter Kit -->
                        <div class="product-card featured">
                            <div class="product-badge">Best Value</div>
                            <div class="product-image">
                                <div class="product-placeholder">
                                    <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                    </svg>
                                </div>
                            </div>
                            <div class="product-info">
                                <h3>Complete Starter Kit</h3>
                                <p class="product-description">Everything you need to get started: TerraDrone 2.1, Flow deck, charger, and comprehensive documentation.</p>
                                <div class="product-features">
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>TerraDrone 2.1</span>
                                    </div>
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>Flow deck v2</span>
                                    </div>
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>USB charger</span>
                                    </div>
                                    <div class="feature-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        <span>User manual</span>
                                    </div>
                                </div>
                                <div class="product-price">
                                    <span class="price">$329</span>
                                    <span class="price-old">$398</span>
                                    <span class="price-label">USD</span>
                                </div>
                                <button class="btn btn-primary btn-buy">Add to Cart</button>
                            </div>
                        </div>
                    </div>

                    <div class="shop-footer">
                        <div class="shop-info">
                            <h3>Why Choose TerraDrone?</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                    </svg>
                                    <h4>Open Source</h4>
                                    <p>Fully open-source hardware and software for complete customization</p>
                                </div>
                                <div class="info-item">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                    </svg>
                                    <h4>Research Grade</h4>
                                    <p>Used by universities and research institutions worldwide</p>
                                </div>
                                <div class="info-item">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                    <h4>Affordable</h4>
                                    <p>Professional features at a fraction of the cost of commercial drones</p>
                                </div>
                                <div class="info-item">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                    </svg>
                                    <h4>Modular</h4>
                                    <p>Expandable with various decks for different applications</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Log Client Tab -->
            <div id="logclient-tab" class="tab-content">
                <div class="panel">
                    <h3>Log Client</h3>
                    <div class="logclient-controls">
                        <button id="clearLogClientBtn" class="btn btn-primary">Clear</button>
                    </div>
                    <div id="logClientOutput" class="logclient-output">
                        <p class="info-text">Client-side logging information will appear here</p>
                    </div>
                </div>
            </div>

            <!-- CRTP Shark Tab -->
            <div id="crptshark-tab" class="tab-content">
                <div class="panel">
                    <h3>CRTP Shark</h3>
                    <div class="crptshark-controls">
                        <label><input type="checkbox" id="crptsharkMasterCheck" checked> Master</label>
                        <button id="clearCrptsharkBtn" class="btn btn-primary">Clear</button>
                        <button id="saveCrptsharkBtn" class="btn btn-secondary">Save</button>
                    </div>
                    <div id="crptsharkTable" class="crptshark-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>ms</th>
                                    <th>Direction</th>
                                    <th>Port/Chan</th>
                                    <th>Data</th>
                                </tr>
                            </thead>
                            <tbody id="crptsharkTableBody">
                                <tr>
                                    <td colspan="4" class="info-text">Packet data will appear here</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Connection Dialog -->
    <div id="connectionDialog" class="modal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2>Connection Settings</h2>
                <span class="modal-close" onclick="closeConnectionDialog()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="connection-modal-content">
                    <div class="form-group">
                        <label>Interface</label>
                        <select id="interfaceSelect" class="select">
                            <option value="">Select interface...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Address</label>
                        <input type="text" id="addressInput" class="input" placeholder="udp://192.168.43.42:2390">
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="autoReconnect">
                            <span>Auto Reconnect</span>
                        </label>
                    </div>
                    
                    <div id="scanResults" class="scan-results" style="display: none;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="scanBtn" class="btn btn-secondary">Scan Devices</button>
                <button id="connectBtn" class="btn btn-success" disabled>Connect</button>
                <button id="disconnectBtn" class="btn btn-danger" disabled style="display: none;">Disconnect</button>
            </div>
        </div>
    </div>

    <!-- About Dialog -->
    <div id="aboutDialog" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>About TerraDrone Web Interface</h2>
                <span class="modal-close" onclick="closeAboutDialog()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="about-content">
                    <div class="about-logo">
                        <h1 style="color: #667eea; font-size: 48px; margin: 0;">TerraDrone</h1>
                        <p style="color: #666; margin: 5px 0 20px 0;">Web Interface</p>
                    </div>
                    <div class="about-info">
                        <p><strong>Version:</strong> 1.0.0</p>
                        <p><strong>Copyright:</strong> © 2023 Bitcraze AB</p>
                        <p style="margin-top: 20px;">This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation.</p>
                        <p style="margin-top: 10px;"><a href="https://www.bitcraze.io" target="_blank" style="color: #667eea;">www.bitcraze.io</a></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeAboutDialog()">Close</button>
            </div>
        </div>
    </div>

    <!-- Bootloader Dialog -->
    <div id="bootloaderDialog" class="modal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2>Bootloader</h2>
                <span class="modal-close" onclick="closeBootloaderDialog()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="bootloader-content">
                    <p>Bootloader functionality allows you to update the firmware on your TerraDrone.</p>
                    <div class="form-group">
                        <label>Select firmware file:</label>
                        <input type="file" id="firmwareFile" accept=".bin,.hex" class="input">
                    </div>
                    <div class="form-group">
                        <button id="flashFirmwareBtn" class="btn btn-primary" disabled>Flash Firmware</button>
                        <button id="resetToBootloaderBtn" class="btn btn-secondary">Reset to Bootloader</button>
                    </div>
                    <div id="bootloaderStatus" class="bootloader-status"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBootloaderDialog()">Close</button>
            </div>
        </div>
    </div>

    <!-- CF2 Config Dialog -->
    <div id="cf2ConfigDialog" class="modal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2>Configure TerraDrone 2.X</h2>
                <span class="modal-close" onclick="closeCf2ConfigDialog()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="cf2-config-content">
                    <p>Configure settings for TerraDrone 2.X devices.</p>
                    <div class="form-group">
                        <label>Device Type:</label>
                        <select id="cf2DeviceType" class="select">
                            <option value="cf2">TerraDrone 2.0</option>
                            <option value="cf21">TerraDrone 2.1</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="cf2EnableLED"> Enable LED ring</label>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="cf2EnableZRanger"> Enable Z-Ranger</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveCf2Config()">Save</button>
                <button class="btn btn-secondary" onclick="closeCf2ConfigDialog()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Log Config Dialog -->
    <div id="logConfigDialog" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Logging Configurations</h2>
                <span class="modal-close" onclick="closeLogConfigDialog()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="log-config-content">
                    <div class="log-config-list">
                        <h4>Saved Configurations</h4>
                        <div id="logConfigList" class="config-list">
                            <p class="info-text">No saved configurations</p>
                        </div>
                        <div class="log-config-actions">
                            <button id="loadLogConfigBtn" class="btn btn-primary" disabled>Load</button>
                            <button id="deleteLogConfigBtn" class="btn btn-danger" disabled>Delete</button>
                            <button id="newLogConfigBtn" class="btn btn-secondary">New</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeLogConfigDialog()">Close</button>
            </div>
        </div>
    </div>

    <!-- Input Device Configuration Dialog -->
    <div id="inputConfigDialog" class="modal">
        <div class="modal-content modal-landscape">
            <div class="modal-header">
                <h2>Input device configuration</h2>
                <span class="modal-close" onclick="closeInputConfigDialog()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="input-config-section">
                    <label>Input device:</label>
                    <select id="inputDeviceSelector" class="select">
                        <option value="">Select device...</option>
                    </select>
                    <button id="configureDeviceBtn" class="btn btn-primary">Configure</button>
                </div>
                
                <div class="input-config-main">
                    <div class="input-response-section">
                        <h4>Input response</h4>
                        <div class="axis-control">
                            <label>Roll:</label>
                            <div class="slider-container">
                                <input type="range" id="rollSlider" class="slider horizontal" min="-100" max="100" value="0" disabled>
                                <div class="slider-value" id="rollValue">0</div>
                            </div>
                            <button id="detectRoll" class="btn btn-secondary">Detect</button>
                        </div>
                        <div class="axis-control">
                            <label>Pitch:</label>
                            <div class="slider-container vertical">
                                <input type="range" id="pitchSlider" class="slider vertical" min="-100" max="100" value="0" disabled>
                                <div class="slider-value" id="pitchValue">0</div>
                            </div>
                            <button id="detectPitch" class="btn btn-secondary">Detect</button>
                        </div>
                        <div class="axis-control">
                            <label>Yaw:</label>
                            <div class="slider-container">
                                <input type="range" id="yawSlider" class="slider horizontal" min="-100" max="100" value="0" disabled>
                                <div class="slider-value" id="yawValue">0</div>
                            </div>
                            <button id="detectYaw" class="btn btn-secondary">Detect</button>
                        </div>
                        <div class="axis-control">
                            <label>Thrust:</label>
                            <div class="slider-container vertical">
                                <input type="range" id="thrustSlider" class="slider vertical" min="0" max="100" value="0" disabled>
                                <div class="slider-value" id="thrustSliderValue">0</div>
                            </div>
                            <button id="detectThrust" class="btn btn-secondary">Detect</button>
                        </div>
                        
                        <div class="calibration-controls">
                            <div class="cal-control">
                                <label><input type="checkbox" id="pitchPosCheck"> Pitch +</label>
                                <button id="detectPitchPos" class="btn btn-secondary btn-small">Detect</button>
                            </div>
                            <div class="cal-control">
                                <label><input type="checkbox" id="rollNegCheck"> Roll -</label>
                                <button id="detectRollNeg" class="btn btn-secondary btn-small">Detect</button>
                            </div>
                            <div class="cal-control">
                                <label><input type="checkbox" id="rollPosCheck"> Roll +</label>
                                <button id="detectRollPos" class="btn btn-secondary btn-small">Detect</button>
                            </div>
                            <div class="cal-control">
                                <label><input type="checkbox" id="pitchNegCheck"> Pitch -</label>
                                <button id="detectPitchNeg" class="btn btn-secondary btn-small">Detect</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-mapping-section">
                        <h4>Action mapping</h4>
                        <div class="action-list">
                            <div class="action-item">
                                <label><input type="checkbox" id="assistedControlCheck"> Assisted control</label>
                                <button id="detectAssistedControl" class="btn btn-secondary btn-small">Detect</button>
                            </div>
                            <div class="action-item">
                                <label><input type="checkbox" id="emergencyStopCheck"> Emergency stop</label>
                                <button id="detectEmergencyStop" class="btn btn-secondary btn-small">Detect</button>
                            </div>
                            <div class="action-item">
                                <label><input type="checkbox" id="armCheck"> Arm/disarm</label>
                                <button id="detectArm" class="btn btn-secondary btn-small">Detect</button>
                            </div>
                            <div class="action-item">
                                <label><input type="checkbox" id="exitAppCheck"> Exit app</label>
                                <button id="detectExitApp" class="btn btn-secondary btn-small">Detect</button>
                            </div>
                            <div class="action-item">
                                <label><input type="checkbox" id="alt1Check"> Alt 1</label>
                                <button id="detectAlt1" class="btn btn-secondary btn-small">Detect</button>
                            </div>
                            <div class="action-item">
                                <label><input type="checkbox" id="alt2Check"> Alt 2</label>
                                <button id="detectAlt2" class="btn btn-secondary btn-small">Detect</button>
                            </div>
                            <div class="action-item">
                                <label><input type="checkbox" id="muxSwitchCheck"> Mux switch</label>
                                <button id="detectMuxSwitch" class="btn btn-secondary btn-small">Detect</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-section">
                    <label>Profile name:</label>
                    <select id="profileSelector" class="select">
                        <option value="">Select profile...</option>
                    </select>
                    <button id="deleteProfileBtn" class="btn btn-danger">Delete</button>
                    <button id="loadProfileBtn" class="btn btn-secondary">Load</button>
                    <button id="cancelConfigBtn" class="btn btn-secondary">Cancel</button>
                    <button id="saveConfigBtn" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js" onerror="console.error('Socket.IO failed to load - WebSocket functionality will not work')"></script>
    <script src="app.js"></script>
</body>
</html>
